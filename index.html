<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Loading</title>
  <!--<link rel="stylesheet" href="https://unpkg.com/water.css@2.1.1/out/water.css"
    integrity="sha384-eHoWBq4xGyEfS3rmZe6gvzlNS/nNJhiPPbKCJN1cQHJukU+q6ji3My2fJGYd1EBo" crossorigin="anonymous" />
  <script src="https://unpkg.com/htmx.org@1.8.2/dist/htmx.js"
    integrity="sha384-dUlt2hvoUDyqJ29JH9ln6o/B23lVQiQm8Z0+oEuPBWwKXiyG2MozxxFsCKWM7dLl"
    crossorigin="anonymous"></script>-->
  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("sw.js")
        .then(reg => {
          reg.addEventListener('statechange', event => {
            console.log("received `statechange` event", { reg, event })
          });
          console.log("service worker registered", reg);
          reg.active.postMessage({ type: 'clientattached' });
        }).catch(err => {
          console.error("service worker registration failed", err);
          //refreshToWasm(250);
        });
      navigator.serviceWorker.addEventListener('controllerchange', event => {
        console.log("received `controllerchange` event", event);
        window.location.reload();
      });
    } else {
      console.error("serviceWorker is missing from `navigator`. Note service workers must be served over https or on localhost");
    }

    // async function refreshToWasm(milliseconds) {
    //   await new Promise(resolve => setTimeout(resolve, milliseconds));
    //   window.location.reload(); // --> Immediate redirection to initiate WASM
    // }
  </script>
</head>

<body>

</body>
</html>